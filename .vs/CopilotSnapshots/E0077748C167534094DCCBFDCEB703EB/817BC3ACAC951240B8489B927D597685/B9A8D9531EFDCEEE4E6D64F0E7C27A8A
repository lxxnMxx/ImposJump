using UnityEngine;
using UnityEngine.UI;

public class SettingsManager : Singleton<SettingsManager>, IDataPersistence
{
    public Settings settings;

	[SerializeField] private SoundManager soundManagerPrefab;

	[SerializeField] Slider sfxGlobal;
	[SerializeField] Slider sfxUiGlobal;

	void IDataPersistence.LoadData(GameData data)
	{
		settings = data.settings;
		sfxGlobal.value = settings.sfxGloabalVolume;
		sfxUiGlobal.value = settings.uiGloabalVolume;
		SetVolume();
	}

	void IDataPersistence.SaveData(ref GameData data)
	{
		data.settings = settings;
	}

	public void SaveSettings()
	{
		settings.sfxGloabalVolume = sfxGlobal.value;
		settings.uiGloabalVolume = sfxUiGlobal.value;
		print("Settings saved");
		SetVolume();
	}

	private void SetVolume()
	{
		foreach(Sound s in soundManagerPrefab.uiSounds)
		{
			s.source.volume = s.volume * settings.uiGloabalVolume;
		}
		foreach(Sound s in soundManagerPrefab.playerSounds)
		{
			s.source.volume = s.volume * settings.sfxGloabalVolume;
		}
		foreach(Sound s in soundManagerPrefab.alienSounds)
		{
			s.source.volume = s.volume * settings.sfxGloabalVolume;
		}
	}
}
